%TCIDATA{LaTeXparent=0,0,relatorio.tex}
\chapter{Metodologia}

Neste capítlulo são descritas as metodologias e ferramentas utilizadas para o desenvolvimento deste trabalho, em particular os algoritmos para obtenção de arquivos e a extração de métricas para a análise de estilo de códigos escritos em Python.

\section{Ferramentas}

Nesta seção são descritas as versões, releases e ferramentas utilizadas no desenvolvimento deste estudo, tais como os sistemas operacionais Windows 8 e Linux Mint 17, o IDE Eclipse, o plugin PyDev e editor de texto Vim.

\subsection{Sistema Operacional Windows}

Windows 8 é o mais novo membro da família Windows, projetado para ser utilizado em  dispositivos móveis ou computadores pessoais, com uma interface totalmente nova e adaptada para dispositivos sensíveis ao toque \cite{intowindows8-2012}. Neste trabalho foi utilizado o Windows 8.1, versão 6.3.9600, 64 bits, ilustrado na Figura \ref{win8}.

\begin{figure}[ht!]
\centering
\includegraphics[scale=0.3]{figs/win8.png}
\caption{Windows 8 \label{win8}}
\end{figure}

\subsection{Sistema Operacional Linux}
\label{linux_mint}
O Linux Mint é  uma distribuição livre de custos e de código aberto, voltado para a comunidade. Baseado em Debian e Ubuntu, é a mais popular distribuição Linux e o terceiro sistema operacional mais utilizado em computadores pessoais, atrás somente de Microsoft Windows e Mac OSX da Apple \cite{linuxmint_2015}. A versão utilizada  neste trabalho foi Linux Mint 17, 64 bits,  ilustrado na Figura \ref{mint}.

\begin{figure}[ht!]
\centering
\includegraphics[scale=0.35]{figs/mint.png}
\caption{Linux Mint 17 \label{mint}}
\end{figure}

\subsection{IDE's -- Eclipse}

O Eclipse é o IDE utilizado neste projeto, por ser de fácil aprendizagem e possuir um núcleo extremamente adaptável às necessidades do projeto. A versão utilizada  neste trabalho é 
Eclipse Luna Release (4.4.0), build id: 20140612-0600\footnote{http://bit.ly/1EPcAGg}\footnote{http://bit.ly/1KY7Zqh}.

A tela principal do Eclipse pode ser vista na Figura  \ref{eclipse}.

\begin{figure}[ht!]
\centering
\includegraphics[width=140mm]{figs/eclipse.png}
\caption{IDE Eclipse \label{eclipse}}
\end{figure}

\subsection{IDE's -- PyDev}

PyDev é um plugin do IDE Eclipse, que pode ser usado  para desenvolvimento em Python, Jython e IronPython \cite{pydev_2015}. A Figura \ref{pydev} ilustra o IDE Eclipse com o plugin PyDev. A versão utilizada é 3.9.0\footnote{http://pydev.org/updates}.

\begin{figure}[ht!]
\centering
\includegraphics[width=140mm]{figs/pydev.png}
\caption{IDE Eclipse com plugin PyDev \label{pydev}}
\end{figure}

\subsection{Editores de texto -- VIM}

Segundo \cite{learning-vim-2008}, a sigla VIM significa \lq\lq vi melhorado\rq\rq. O VIM é um editor de texto que foi escrito e é mantido por Bram Moolenaar. Atualmente, Vim é talvez o clone do vi mais amplamente utilizados, e existe um domínio da Internet\footnote{http://vim.org} dedicado a ele. A versão atual é  a 7.1. Irrestrito por normas ou comitês, o Vim continua a crescer em termos de funcionalidade. Uma comunidade inteira cresceu em torno dele. Coletivamente,  os membros da comunidade decidem os novos recursos a serem adicionados e as funcionalidades existentes a serem modificadas através da nomeação e votação para sugestões durante os ciclos de desenvolvimento.

Vim é um editor modal no sentido de que as teclas do teclado têm diferentes funções em cada modo de operação; possui suporte a expressões regulares em buscas, com várias extensões à sintaxe padrão de expressões regulares, mapeamento de qualquer tecla do teclado e corretor ortográfico a partir da versão 7.0; funciona tanto no console/terminal quanto em ambiente gráfico (que neste caso utiliza o aplicativo gVim); é absolutamente programável, via interfaces com interpretadores (Perl, Python, Ruby) ou via seu próprio interpretador; contém vários temas de cores e tem licença GPL \cite{vim_2015}.

A tela do editor modo texto Vim pode ser vista na Figura \ref{vim}

\begin{figure}[ht!]
\centering
\includegraphics[width=140mm]{figs/vim.png}
\caption{Editor Vim em modo texto \label{vim}}
\end{figure}

A versão utilizada neste trabalho é a 7.4 que pode ser obtida através do repositório oficial do sistema operacional Linux Mint 17.

\subsection{PEP8 \textit{Tools}}

É uma ferramenta de verificação de código-fonte em linguagem Python que valida as convenções propostas pelo estilo PEP8 (Anexo \ref{anexoB}). Tem como característica  principal a arquitetura de plugins, que podem ser incorporados  à ferramentas como interpretadores de comando e IDEs. \cite{peptools_2015}

Sua instalação, atualização e desinstalação podem ser realizadas através dos comandos descritos na Tabela \ref{instpep8}.

\begin{table}[ht!]
        \caption{Instalação e desinstalação pep8.}
        \label{instpep8}
        \centering
        \begin{tabularx}{0.95\textwidth}{>{\ttfamily}X}
        \midrule
                \$ pip install pep8 \\
                \$ pip install --upgrade pep8 \\
                \$ pip uninstall pep8 \\
        \bottomrule
        \end{tabularx}
\end{table}

A ajuda rápida está disponível através da linha de comando \lq\lq\texttt{pep8 -h}\rq\rq, que tem como resposta as opções listadas na Tabela \ref{helpPep8}.

\begin{table}[ht!]
        \caption{Pep8 Ajuda.}
        \label{helpPep8}
        \centering
        \begin{small}
        \begin{tabularx}{0.99\textwidth}{>{\ttfamily}lX}
        \toprule
                \textbf{Opções} & \textbf{Descrição} \\
        \midrule
	        --version & Exibe o número da versão e finaliza o programa.\\
	\rowcolor[gray]{0.8}
		-h, --help & Exibe esta tabela de parâmetros de comandos e finaliza o programa.\\
		-v, --verbose & Exibe mensagens de status imprimindo o conteúdo do comando ou depuração com o parâmetro -vv.\\
	\rowcolor[gray]{0.8}
		-q, --quiet & Relatório apenas com os nomes dos arquivos, ou arquivo vazio com o paramêtro -qq. \\
		--first & Exibe a primeira ocorrência de cada erro.\\
	\rowcolor[gray]{0.8}
		--exclude=patterns & Excluir arquivos ou diretórios que correspondem aos itens separados por vírgula por padrão é separado as seguintes extensões (.svn, CVS, .bzr, .hg, .git).\\
		--filename=patterns & Analisa diretório e verificar nomes de arquivos que contém extensão (* .py).\\
	\rowcolor[gray]{0.8}
		--select=errors & Selecione os erros e avisos (por exemplo, E, W6).\\
		--ignore=errors & Ignorar os erros e avisos (por exemplo, E4, W).\\
	\rowcolor[gray]{0.8}
		--show-source & Exibe o código-fonte para cada erro.\\
		--show-pep8 & Exibe texto do PEP 8 para cada erro.\\
	\rowcolor[gray]{0.8}
		--statistics & Calcula a quantidade de erros e alertas.\\
		--count & Imprimir o número total de erros e alertas para o padrão de erro e definir o código de saída para 1 se o total não é nulo.\\
	\rowcolor[gray]{0.8}
		--max-line-length=n & Define o comprimento máximo permitido por cada linha (padrão: 79). \\
		--hang-closing & Formatação para abrir e fechar colchetes, utilizando recuo como endentação. \\
	\rowcolor[gray]{0.8}
		--format=format & definir o formato de erro [ pylint | <custom>], o padrão é o pylint. \\
		--diff & Exibe um relatório apenas com as linhas alteradas de acordo com a comparação unificada recebido por parâmetros entrada. \\
	\rowcolor[gray]{0.8}
		--benchmark & Mede a velocidade de processamento. \\
	\bottomrule
        \end{tabularx}
        \end{small}
\end{table}

A Tabela \ref{statistpep8} contem um exemplo de utilização de um dos parâmetros da Tabela \ref{helpPep8}.

\begin{table}[ht!]
        \caption{Estatísticas referentes à execução do pep8.}
        \label{statistpep8}
        \centering
        \begin{tabularx}{0.95\textwidth}{>{\ttfamily}X}
        \midrule
        \textbf{\$ pep8 --statistics -qq Python-2.5/Lib} \\
	232 \hspace{3mm} E201 Espaços em branco depois de '[' \\
	631 \hspace{3mm} E203 Espaços em branco antes de ',' \\
	842 \hspace{3mm} E211 Espaços em branco antes de '(' \\
	2531\hspace{3mm} E221 mútliplos espaços antes de operador \\
	4473\hspace{3mm} E301 esperado 1 linha em branco, encontrada 0 \\
	4006\hspace{3mm} E302 esperado 2 linhas em branco, encontrada 1 \\
	165 \hspace{3mm} E303, muitas linhas em branco (4) \\
	325 \hspace{3mm} E401 mútliplos importes em uma linha \\
	3615\hspace{3mm} E501 linha muito longa (82 characters) \\
	\bottomrule
	\end{tabularx}
\end{table}

O comportamento  da ferramenta pode ser configurado a partir do caminho do arquivo que, dependendo da versão, pode ter o nome de tox.ini, setup.cfg ou ter a extensão .pep8.  O caminho deste arquivo é \lq\lq\texttt{/etc/config/arquivo}\rq\rq, quando o sistema operacional é Linux; caso seja Windows, o caminho é \lq\lq\texttt{\%userprofile\%/pep8}\rq\rq.

O Código \ref{configPep8} contém um modelo de configuração encontrada ao abrir o arquivo de comportamento.

\lstinputlisting[language=Bash, caption=Arquivo de configuração., label=configPep8]{cods/confPep8.sh}

O Anexo A exibe a lista atual de códigos de erros e de alertas,  que podem vir a ser exibidos após uma analise de um código-fonte.

\subsection{Flake 8}
\label{flake_8}

É uma ferramenta que permite a verificação de erros de sintaxe, estilo de codificação e padrões em códigos escritos em linguagem Python \cite{flake-8_2015}. A versão utilizada é a 2.2.3 release 25-08-2014, versão baseada em Linux,
 
A sua instalação pode ser realizada através da linha de comando exemplificado na Tabela \ref{instflak8}

\begin{table}[ht!]
        \caption{Instalação Flake8.}
        \label{instflak8}
        \centering
        \begin{tabularx}{0.95\textwidth}{>{\ttfamily}X}
        \midrule
         \$ pip install flake8 \\
	\bottomrule
        \end{tabularx}
\end{table}

Na Tabela \ref{sintxflak8} é exemplificada a sintaxe de uso da ferramenta em um determinado projeto, e com seus respectivos resultados, na qual apresenta a estrutura de uma letra do alfabeto, seguida  de um número e uma mensagem descrevendo a violação ao estilo descrito na seção \ref{pep8} detectada.

\begin{table}[ht!]
        \caption{Sintaxe de uso do Flake8.}
        \label{sintxflak8}
        \centering
        \begin{tabularx}{0.9\textwidth}{>{\ttfamily}X}
        \midrule
		\textbf{\$ flake8 coolproject} \\
		coolproject/mod.py:97:1: F401 'shutil' imported but unused \\
		coolproject/mod.py:625:17: E225 missing whitespace around operator \\
		coolproject/mod.py:729:1: F811 redefinition of function 'readlines' from line 723 \\
		coolproject/mod.py:1028:1: F841 local variable 'errors' is assigned to but never use \\
        \bottomrule
        \end{tabularx}
\end{table}

\section{Linguagens de Programação}

\subsection{Java}

A linguagem de programação Java foi utilizada para criar o algorítimo que captura arquivos compactados e o armazenamento localmente para a realização da validação deste trabalho.
A versão utilizada para o desenvolvimento dos procedimentos escritos em java é JDK 7 \textit{Java SE Development Kit} release 1.7.0\_75, e pode ser obtido no endereço eletrônico \footnote{http://bit.ly/1mTJaPC}.

\subsection{Python}

A versão utilizada neste trabalho é a 2.7.9, release 10-12-2014, esta versão faz parte da instalação padrão do sistema operacional citado na seção \ref{linux_mint}, caso deseje executar uma instalação de outra versão superior a utilizada neste estudo, é necessário acessar o sítio oficial da linguagem, na aba de downloads\footnote{https://www.python.org/downloads/}.

\section{Extrator de métricas}

Neste capítulo detalharemos os procedimentos efetuados para verificar se os projetos contidos  no repositório de software livre PyPI \cite{pypi_2015} escritos em  Python estão aderentes ao padrão descrito na seção \ref{pep8}, e qual o nível de adoção de cada projeto.

\subsection{Rotinas e Scripts}

O desenvolvimento dos scripts se deu pela necessidade de automatizar o processo de identificação e transferência de um ou mais arquivos de um servidor remoto para um computador local, tornando processo necessário para prosseguir com o procedimento de análise do estilo de codificação recomendadas para a linguagem Python e a quatificação das métricas avaliadas.

\subsection{Rotinas Java}

A primeira etapa consiste na leitura de uma página web do endereço eletrônico\footnote{https://pypi.python.org/pypi?:action=index} para a obtenção dos endereçamentos dos arquivos compactados. Para a execução desta tarefa foi desenvolvido um procedimento escrito em Java.

O Código \ref{obtLinksPac} apresenta o método utilizado para realizar a captura dos endereços eletrônicos dos arquivos compactados a serem salvos localmente. 

\lstinputlisting[language=Java, caption=Código para obter endereços dos pacotes., label=obtLinksPac]{cods/ObterLinkPacotes_new.java}

O resultado do procedimento acima, gerou um arquivo texto denominado \texttt{write.txt}, contendo 63.313.00 mil linhas. A Tabela \ref{linksobt}, exemplifica um trecho do arquivo de texto que foi criado.

\begin{table}[ht!]
        \caption{Links obtidos pelo Código \ref{obtLinksPac} .}
        \label{linksobt}
        \centering
        \begin{tabularx}{0.95\textwidth}{>{\ttfamily}X}
        \midrule
                https://pypi.python.org/pypi/02exercicio/1.0.0\\
		https://pypi.python.org/pypi/0x10c-asm/0.0.2\\
		https://pypi.python.org/pypi/115wangpan/0.5.0\\
		https://pypi.python.org/pypi/131228\_pytest\_1/1.0.0\\
		https://pypi.python.org/pypi/1337/1.0.0\\
		https://pypi.python.org/pypi/17MonIP/0.2.4\\
		https://pypi.python.org/pypi/18-e/final\\
		https://pypi.python.org/pypi/1ee/1.0.0\\
		https://pypi.python.org/pypi/1pass/0.2.1\\
		https://pypi.python.org/pypi/1to001/0.3.0\\
		https://pypi.python.org/pypi/2013007\_pyh/1.0.0\\
		...... \\
	\bottomrule
        \end{tabularx}
\end{table}

Na segunda etapa foi escrito outro procedimento, também em linguagem Java, o qual recebe como parâmetro os endereços obtido na etapa anterior e a partir de cada endereço é executada uma análise baseada em padrões da construção da página para encontrar o endereço eletrônico que endereçava para o arquivo compactado. Assim que a rotina encontrava o endereço eletrônico que foi informado como parâmetro, dava-se início a transferência e o armazenamento do arquivo em um diretório local.

O Código \ref{downFile}, apresenta a rotina de análise da estrutura das páginas web para a descoberta dos links que contém os arquivos compactados.

\lstinputlisting[language=Java, caption=Obter link dos arquivos compactados., label=downFile]{cods/UrlContent.java}

O Código \ref{downFile2} apresenta o método utilizado para realizar a transferência e o armazenamento dos arquivos compactados. 

\lstinputlisting[language=Java, caption=Obter arquivos compactados., label=downFile2]{cods/UrlContent2.java}

As etapas anteriores foram adotadas a linguagem de programação Java \cite{java_2015} por se tratar de uma linguagem que possui maior desempenho e menor consumo de processamento segundo o comparativo descrito em \cite{BencJavaPython}, neste endereço é exibido um comparativo entre as linguagens Java e Python.

Para a criação e execução dos procedimentos acima mencionados foram encontrados alguns obstáculos a serem superados. A primeira dificuldade foi a de compreender a estrutura do site na qual está localizado o repositório com os arquivos compactados para o download, pois o domínio \cite{pypi_2015} além de conter vários endereços (o que torna a página pesada e extensa de se carregar e navegar), os mesmos não direcionavam ao arquivo desejado e sim a uma nova página que continha uma outra página com uma determinada estrutura que também necessitava de análise para criar rotinas para a localização do arquivo para que pudesse ser salvo no disco rígido.
 
A outra dificuldade foi o tempo necessário para a execução e conclusão do processo de aquisição dos pacotes \cite{pypi_2015} , pois a cada período de execução dos algoritmos o tempo de resposta para a obtenção dos arquivos aumentava. Isto foi consequência do mecanismo de defesa utilizado pelo endereço eletrônico que continha os arquivos compactados, de modo que todo o processo  teve a duração média de 4 dias para finalizar sua execução. A execução do script não aconteceu ininterruptamente pois houveram interrupções e intervenções manuais quando ocorria erros ou tratamento de exceção para os arquivos não encontrados ou endereços eletrônicos inexistentes. A Tabela \ref{exctransarq}, exemplifica os tipos de exceções encontradas na transferência dos arquivos.

\begin{table}[ht!]
        \caption{Exceções na transferência de arquivos.}
        \label{exctransarq}
        \centering
	\begin{small}
        \begin{tabularx}{0.99\textwidth}{>{\ttfamily}X}
        \midrule
        	00:12:25,713 ERROR UrlContent:237 - http://aha-gae.googlecode.com/files \\
		/project.zip\%20rel=nofollow \\
		00:14:12,920 ERROR UrlContent:237 - Software caused connection abort: recv failed 
		00:16:54,874 ERROR UrlContent:237 - Server returned HTTP response code: 403 for \\
		URL: http://jamwt.com/downloads/apricot/apricot-0.2.tar.gz \\
		00:17:03,524 ERROR UrlContent:237 - https://bitbucket.org/ganymed/ \\
		araldo/downloads/araldo-redis-latest.tar.gz \\
		00:17:04,618 ERROR UrlContent:237 - https://bitbucket.org/ganymed/ \\
		araldo/downloads/araldo-websocket-latest.tar.gz \\
		00:17:52,369 ERROR UrlContent:237 - http://programmer-art.org/media/ \\ 
		releases/arista-transcoder/arista-0.9.7.tar.gz \\
		00:18:31,121 ERROR UrlContent:237 - Server returned HTTP response code: \\
		400 for URL: http://sourceforge.net/project/downloading.php \\
		00:18:43,788 ERROR UrlContent:237 - https://code.google.com/p/pyswim/ \\
		downloads/detail \\
		00:20:07,981 ERROR UrlContent:237 - Unexpected end of file from server \\
		00:20:53,183 ERROR UrlContent:237 - http://www.wayforward.net/avdata/ \\
		avdata-0.1.0.tar.gz \\
		19:19:06,759 ERROR UrlContent:237 - Connection timed out: connect \\
	\bottomrule
        \end{tabularx}
	\end{small}
\end{table}

\subsection{Scripts Python}
\label{scriptsPython}

Para o desenvolvimento do script responsável pela análise e coleta das métricas proposta na seção \ref{pep8}, utilizamos a linguagem Python e o sistema operacional Linux, também é aplicada a técnica de desenvolvimento chamada programação em par.
 
A programação em par é uma das práticas primárias da metodologia XP. Como o nome sugere, é uma prática de programação que envolve dois programadores em um mesmo computador trabalhando de forma colaborativa. Um programador piloto implementa o código controlando o teclado e o mouse. Outro programador observa o piloto e é responsável por revisar o código ao mesmo tempo, prevenindo e identificando erros lógicos e sintáticos no código. Ambos os programadores podem atuar nos dois papéis e decidir a freqüência da troca \cite[pg. 38-42]{pairprogram_2002}.
 
Tal prática foi adotada pelo fato de que o código produzido, é visto por pelo menos duas pessoas, diminuindo a possibilidade de erros, com isto possuí menor manutenibilidade, aumenta a velocidade de desenvolvimento e há o compartilhamento de conhecimento.

Os Códigos \ref{extractFile} e \ref{extractFile2} exibem as rotinas desenvolvidas para a obtenção dos resultados gerados utilizando as métricas do guia de estilo descritas na seçao \ref{pep8}.
O Código \ref{extractFile} é responsável pela execução da ferramenta descrita na Seção \ref{flake_8}.

\lstinputlisting[language=Python, caption=Procedimento responsável pela execução do Código \ref{extractFile}., label=extractFile]{cods/extractFiles.py}

O Código \ref{extractFile2} contém o procedimento referenciado no Código \ref{extractFile}, que tem como tarefa a extração dos arquivos em um arquivo temporário para sua análise.

\lstinputlisting[language=Python, caption=Procedimento responsável pela execução do Código \ref{extractFile2}., label=extractFile2]{cods/extractFiles2.py}

O script foi desenvolvido em duas partes contendo as seguintes funcionalidades:

\begin{itemize}
	\item Acessar um determinado diretório (neste trabalho, chamado \texttt{/tcc-unb/arquivos});
	\item Ler arquivo com extensões \texttt{*.zip}, \texttt{*.tar.gz}, \texttt{*.bz2}, \texttt{*.egg}, \texttt{*.tgz}, e \texttt{*.whl}. descompactado em um diretório temporário do sistema operacional (por, exemplo, \texttt{\\tmp});
	\item Após a extração do arquivo, executar o flake8, ferramenta citada no item \ref{flake_8}, tendo como parâmetros as regras mais relevantes. 
	Esta ferramenta analisa, linha a linha, cada arquivo dentro de cada projeto.
	\item Ao término da análise o script move o arquivo compactado para um outro diretório (denominado \lq\lq arquivos-orig\rq\rq), onde contém sub diretórios refentes a sua extensão 
	(por exemplo, \lq\lq \texttt{/arquivos-orig/zip}\rq\rq, \lq\lq \texttt{/arquivos-orig/tar.gz}\rq\rq, \lq\lq \texttt{/arquivos-orig/tgz} \rq\rq etc..).
\end{itemize}

Os procedimentos executados anteriormente deu origem a um arquivo texto denominado resultado-flake8.txt e tem sua estrutura exemplificada a Tabela \ref{exemScriptPep8} 

\begin{table}[ht!]
        \caption{Exemplo do resultado da execução do script com regras \ref{pep8}}
        \label{exemScriptPep8}
        \centering
        \begin{tabularx}{0.95\textwidth}{>{\ttfamily}X}
        \midrule
		ArangoPy-0.0.9.tar.gz \\ %[]
		4 modules \\
		-- /tmp/tmpUn3gdb/ArangoPy-0.0.9/setup.py \\
		-- /tmp/tmpUn3gdb/ArangoPy-0.0.9/arangodb/tests.py \\
		1 \hspace{10mm}      E262 inline comment should start with '\# ' \\
		1 \hspace{10mm}      W292 no newline at end of file \\
		-- /tmp/tmpUn3gdb/ArangoPy-0.0.9/arangodb/\_\_init\_\_.py \\
		-- /tmp/tmpUn3gdb/ArangoPy-0.0.9/arangodb/api.py \\
		1 \hspace{10mm}      E271 multiple spaces after keyword \\
		2 \hspace{10mm}      E303 too many blank lines (2) \\
		5 \hspace{10mm}      E501 line too long (81 > 79 characters) \\
		4 \hspace{10mm}      F821 undefined name 'QueryFilterStatement' \\ 
	\bottomrule
        \end{tabularx}
\end{table}

Um terceiro script é criado utilizando a linguagem python, com a finalidade de quantificar os resultados obtidos, este script é exibido no Código \ref{scriptRules}.

\lstinputlisting[language=Python, caption=Script extrator dos resultados das métricas., label=scriptRules]{cods/extractResultRules.py}

Neste estudo foram removidas as verificações para os seguintes códigos de erros: \texttt{E121}; \texttt{E123}; \texttt{E126}; \texttt{E133}; \texttt{E226}; \texttt{E241}; \texttt{E242}; \texttt{E704}. Esta remoção ocorreu pois de acordo com a Seção \ref{pep8}, estas regras não são aceitas por unanimidade.


